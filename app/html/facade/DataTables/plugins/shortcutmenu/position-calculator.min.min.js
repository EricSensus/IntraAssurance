!function(t){"function"==typeof define&&define.amd?define("position-calculator",["jquery"],t):"object"==typeof module&&module.exports?module.exports=t:jQuery.PositionCalculator=t(jQuery)}(function(t){"use strict";function e(t){return"string"==typeof t&&("window"===t?t=m:"document"===t&&(t=y)),t}function i(t){var e=t.split(" ");return{y:v.test(e[0])?e[0]:"top",x:b.test(e[1])?e[1]:"left"}}function o(t,e){return t===e||!(!t||!e)&&(t.top===e.top&&t.left===e.left&&t.height===e.height&&t.width===e.width)}function r(e){var i=e[0];if(9===i.nodeType)return{width:e.outerWidth(),height:e.outerHeight(),top:0,left:0};if(t.isWindow(i))return{width:e.outerWidth(),height:e.outerHeight(),top:e.scrollTop(),left:e.scrollLeft()};if(i.preventDefault)return{width:0,height:0,top:i.pageY,left:i.pageX};var o=e.offset();return{width:e.outerWidth(),height:e.outerHeight(),top:o.top,left:o.left}}function n(e,i){var o=e[0];if(9!==o.nodeType){if(t.isWindow(o)&&(i.top=e.scrollTop(),i.left=e.scrollLeft()),o.preventDefault)return i.top=o.pageY,void(i.left=o.pageX);var r=e.offset();i.top=r.top,i.left=r.left}}function s(e){var i,o=e[0];return 9===o.nodeType?(o=x,i={top:0,left:0}):t.isWindow(o)?(o=x,i={top:e.scrollTop(),left:e.scrollLeft()}):i=e.offset(),{width:o.clientWidth,height:o.clientHeight,top:i.top+o.clientTop,left:i.left+o.clientLeft}}function l(e,i){var o,r=e[0];9===r.nodeType?(r=x,o={top:0,left:0}):t.isWindow(r)?(r=x,o={top:e.scrollTop(),left:e.scrollLeft()}):o=e.offset(),i.top=o.top+r.clientTop,i.left=o.left+r.clientLeft}function h(t,e){return{y:parseFloat(t.y)*(w.test(t.y)?e.height/100:1),x:parseFloat(t.x)*(w.test(t.x)?e.width/100:1),mirror:t.mirror}}function f(t,e,i){var o={top:0,left:0,middle:.5*t.height,center:.5*t.width,bottom:t.height,right:t.width};return 0!==e.y&&(o.middle+=e.y,e.mirror?(o.top+="top"!==i.y?-1*e.y:e.y,o.bottom+="bottom"!==i.y?-1*e.y:e.y):(o.top+=e.y,o.bottom+=e.y)),0!==e.x&&(o.center+=e.x,e.mirror?(o.left+="left"!==i.x?-1*e.x:e.x,o.right+="right"!==i.x?-1*e.x:e.x):(o.left+=e.x,o.right+=e.x)),o}function a(t){var e=[];return t.top>0&&e.push("top"),t.left>0&&e.push("left"),t.bottom<0&&e.push("bottom"),t.right<0&&e.push("right"),e.length?t.overflow=e:t.overflow=null,t}function u(t,e){return a({top:t.top-e.top,left:t.left-e.left,bottom:t.top+t.height-(e.top+e.height),right:t.left+t.width-(e.left+e.width),overflow:[]})}function d(t,e,i,o){var r,n,s,l={y:e.y,x:e.x},h={y:i.y,x:i.x};if(-1!==o.overflow.indexOf("top")&&(r="top"),-1!==o.overflow.indexOf("bottom")&&(r=r?null:"bottom"),-1!==o.overflow.indexOf("left")&&(n="left"),-1!==o.overflow.indexOf("right")&&(n=n?null:"right"),!r&&!n)return null;switch(t=t===!0?"both":t,s=0,t){case"item":s=1;break;case"target":s=2;break;case"both":s=3}return 1&s&&(r&&(l.y=P[l.y]),n&&(l.x=P[l.x])),2&s&&(r&&(h.y=P[h.y]),n&&(h.x=P[h.x])),{item_at:l,tar_at:h}}function c(t,e,i){var o,r,n,s,l;return l=i?["top","bottom"]:["left","right"],o=t[l[0]],n=e[l[0]],r=-1*t[l[1]],s=-1*e[l[1]],0>o&&(o=0),0>r&&(r=0),0>n&&(n=0),0>s&&(s=0),0>o&&0>r||!(0>n&&0>s)&&n+s>o+r}function p(t,e){"all"===e&&(e=!0);var i=t.distance.overflow;if(!i.length)return t;for(var o,r,n=!1,s=!1,l=i.length-1;l>=0;l--)switch(o=i[l]){case"top":case"bottom":(!s&&e===!0||-1!==e.indexOf(o))&&(r=t.distance[o],t.moveBy.y+=r,t.distance.top-=r,t.distance.bottom-=r,s=!0);break;case"left":case"right":(!n&&e===!0||-1!==e.indexOf(o))&&(r=t.distance[o],t.moveBy.x+=r,t.distance.left-=r,t.distance.right-=r,n=!0)}return a(t.distance),t}function g(t){return this instanceof g?(this.options=this.$itm=this.$trg=this.$bnd=this.itmAt=this.trgAt=this.itmPos=this.trgPos=this.bndPos=this.itmOffset=this.trgOffset=null,void this._init(t)):new g(t)}var m=window,y=document,x=y.documentElement,v=/top|middle|bottom/,b=/left|center|right/,w=/%$/,P={left:"right",center:"center",right:"left",top:"bottom",middle:"middle",bottom:"top"};return g.prototype._init=function(o){var r=this.options=t.extend({},g.defaults,o);return r.item?(this.$itm=r.item.jquery?r.item:t(r.item),0===this.$itm.length?null:(this.$trg=r.target&&r.target.jquery?r.target:t(e(r.target)),this.$bnd=r.boundary&&r.boundary.jquery?r.boundary:t(e(r.boundary)),this.itmAt=i(r.itemAt),this.trgAt=i(r.targetAt),this.resize(),this)):null},g.prototype.resize=function(){var t=this.options,e=r(this.$itm),i=this.$trg.length?r(this.$trg):null;if(this.bndPos=this.$bnd.length?s(this.$bnd):null,!this.itmPos||!o(e,this.itmPos)){this.itmPos=e;var n=h(t.itemOffset,e);n.x=-1*n.x,n.y=-1*n.y,this.itmOffset=f(e,n,this.itmAt)}return this.trgPos&&o(i,this.trgPos)||(this.trgPos=i,i&&(this.trgOffset=f(i,h(t.targetOffset,i),this.trgAt))),this},g.prototype.calcVariant=function(t,e){var i={moveBy:null,distance:null,itemAt:null,targetAt:null};if(this.trgPos&&t&&e){var o={top:this.trgPos.top+this.trgOffset[e.y],left:this.trgPos.left+this.trgOffset[e.x]},r={top:o.top-this.itmOffset[t.y],left:o.left-this.itmOffset[t.x],height:this.itmPos.height,width:this.itmPos.width};i.moveBy={y:r.top-this.itmPos.top,x:r.left-this.itmPos.left},i.distance=this.bndPos?u(this.bndPos,r):null,i.itemAt=t.y+" "+t.x,i.targetAt=e.y+" "+e.x}else i.moveBy={y:0,x:0},i.distance=this.bndPos?u(this.bndPos,this.itmPos):null;return i},g.prototype.calculate=function(){if(null===this.itmPos)return null;var t=this.options;n(this.$itm,this.itmPos),this.trgPos&&n(this.$trg,this.trgPos),this.bndPos&&l(this.$bnd,this.bndPos);var e=this.calcVariant(this.itmAt,this.trgAt);if(!e.distance||!e.distance.overflow)return e;if(t.flip&&"none"!==t.flip&&this.trgPos){var i,o=d(t.flip,this.itmAt,this.trgAt,e.distance);if(o){if(i=this.calcVariant(o.item_at,o.tar_at),!i.distance.overflow)return i;var r={y:!1,x:!1};if(r.y=c(i.distance,e.distance,!0),r.x=c(i.distance,e.distance,!1),r.y!==r.x){if(e=this.calcVariant({y:r.y?o.item_at.y:this.itmAt.y,x:r.x?o.item_at.x:this.itmAt.x},{y:r.y?o.tar_at.y:this.trgAt.y,x:r.x?o.tar_at.x:this.trgAt.x}),!e.distance.overflow)return e}else r.y&&r.x&&(e=i)}}return t.stick&&"none"!==t.stick?p(e,t.stick):e},g.defaults={item:null,target:null,boundary:window,itemAt:"top left",targetAt:"top left",itemOffset:{y:0,x:0,mirror:!0},targetOffset:{y:0,x:0,mirror:!0},flip:"none",stick:"none"},g});