$(function(){if("undefined"!=typeof SITE_PATH){PNotify.prototype.options.styling="fontawesome";var e={dir1:"down",dir2:"right",push:"top",modal:!0,overlay_close:!0},t=SITE_PATH+"/ajax/admin/policies/getcustomer",o=$(".chosen-select"),i=$("#btnsubmit"),l=$("#policy_preview"),n=$(".select-quote"),c=$("#claim-details");i.hide();var a={initCustomerSelect:function(){c.hide(),o.empty(),o.select2({minimumInputLength:2,theme:"bootstrap",placeholder:"Select a customer",allowClear:!0,ajax:{url:t,dataType:"json",delay:250,data:function(e){return{query:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.results,pagination:{more:30*t.page<e.total_count}}},cache:!0}}),o.on("select2:select",function(){a.selectCustomer(this.value)}),$(document).on("change","#policies",function(){a.selectPolicy()}),$(document).on("click","#proceed",function(){$(this).hide(),new PNotify({text:"Please enter claim details",type:"info"}),c.show()})},selectCustomer:function(t){$.ajax({url:SITE_PATH+"/ajax/admin/claims/getpolicies?id="+t,type:"GET",dataType:"json",beforeSend:function(){n.html(PRELOADER2),l.html("")},success:function(i){if(i.status)$("#embedded_quote").html(""),n.html('<label id="label_quote" for="select-quote">Select a policy to use for the New Claim</label>'+i.content),$("input[name=customer_id]").val(t);else{var l=null;try{l=o.select2("data")[0].text}catch(e){l="Selected Customer"}n.html(""),o.val(null).trigger("change"),new PNotify({text:"No policies found for the <strong>"+l+"</strong>",type:"error",stack:e,addclass:"stack-modal"})}}})},selectPolicy:function(){var e=$("#policies").val();if(""===e)return void new PNotify({text:"Please select policy",type:"info"});$.ajax({url:SITE_PATH+"/ajax/admin/claims/getpolicypreview?id="+e,type:"GET",beforeSend:function(){c.hide(),l.html(PRELOADER2)},success:function(t){l.html(t),i.show(),$("input[name=policy_id]").val(e),console.log(e)}})}};a.initCustomerSelect(),$("input[name=customer_id]").val()&&(customer=$("input[name=customer_id]").val(),a.selectCustomer(customer))}});