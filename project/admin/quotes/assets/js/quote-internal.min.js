$(function(){var e=$("#btnSubmit"),a=$("#next"),t=$("#prev");e.hide(),t.hide();var o=$("form#mainform"),i=null,n=!0,r={createTabs:function(){for(e=0;e<4;e++)$(".killer"+e).parents("div.form-group").replaceWith("<div id='mine"+e+"'></div>");$("#mine0").nextUntil("div#mine1").wrapAll('<div class="tab-pane active" id="tab1"></div>'),$("#mine1").nextUntil("div#mine2").wrapAll('<div class="tab-pane" id="tab2"></div>'),$("#mine2").nextUntil("div#mine3").wrapAll('<div class="tab-pane" id="tab3"></div>');for(var e=0;e<3;e++)$("#mine"+e).remove();$(".tab-pane").wrapAll('<div class="tab-content"></div>'),$('<ul class="nav nav-tabs"><li class="active"><a href="#tab1" data-toggle="tab">Proposer Personal Details</a></li><li><a href="#tab2" data-toggle="tab">Insurance Entity Details</a></li><li><a href="#tab3" data-toggle="tab">Cover Details</a></li></ul>').insertBefore("div.tab-content"),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){r.updateBtn(e)}),$("#prev").click(function(){r.moveTab("prev")}),$("#next").click(function(){r.moveTab("next")})},datePickers:function(){$("#dob").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,maxDate:"-15Y"}),$("#coverstart").datepicker({minDate:0,dateFormat:"yy-mm-dd",changeMonth:!0,onSelect:function(e){var a=new Date(e);a.setFullYear(a.getFullYear()+1),$("#coverend").datepicker("setDate",a)}}),$("#coverend").datepicker({dateFormat:"yy-mm-dd"})},isFormValid:function(){if(n=!0,$("input:required,select:required,textarea:required").each(function(){0==$.trim($(this).val()).length||"0.00"==$.trim($(this).val())?($(this).parent().addClass("form-group has-error"),n=!1):$(this).parent().removeClass("has-error")}),n)d.submitForm();else{var e=$(".has-error:first").parents("div.tab-pane").attr("id");$("a[href=#"+e+"]").click()}},inUrl:function(e){return window.location.href.indexOf(e)>-1},setUrl:function(){var e=null;r.inUrl("/motor")?(l.additionalCovers(),e="motor"):r.inUrl("/accident")?(s.additionalCovers(),e="accident"):r.inUrl("/domestic")&&(e="domestic"),o.attr("action",SITE_PATH+"/admin/myquote/save/"+e)},updateBtn:function(o){var i=$(o.target).attr("href");e.hide(),a.hide(),t.hide(),"#tab3"===i?(a.hide(),t.show(),e.show()):"#tab1"===i?(t.hide(),a.show()):(t.show(),a.show())},moveTab:function(e){var a=$(".nav-tabs li.active");sibbling="next"===e?a.next():a.prev(),console.log(a,sibbling),sibbling.is("li")&&sibbling.children("a").tab("show")}},l={addContent:function(e){var a=SITE_PATH+"/motor/others/"+e;$.get(a,function(e){var a=l.cleanResponse(e);$("#tab22").html(a),$("#btnToSubmit").parents("div.form-group").remove()})},cleanResponse:function(e){return $("<div>"+e+"</div>").find("form").contents().unwrap().wrapAll("div")},additionalCovers:function(){var e=!1,a=$("select[name=othercovers]"),t=$("input[name=somecovers]");a.prop("disabled",!0),t.change(function(){"yes"===this.value?(e=!0,a.prop("disabled",!1),a.val(1).trigger("change")):(e=!1,a.val("").trigger("change"),a.prop("disabled",!0))}),a.change(function(){if(""==this.value)return $('li:has(a[href="#tab22"])').remove(),void $("#tab22").remove();$("#tab22").length||($("ul.nav li:last").before('<li><a href="#tab22" data-toggle="tab">Other Car Details</a></li>'),$(this).parents("div.tab-pane").after('<div class="tab-pane" id="tab22">'+PRELOADER2+"</div>")),l.addContent($(this).val())})}},s={additionalCovers:function(){var e=!1,a=$("select#howmany"),t=$("input[name=other_covers]");a.prop("disabled",!0);var o=$("div#other_covers_div");t.change(function(){"yes"===this.value?(e=!0,a.prop("disabled",!1),a.val(1).trigger("change")):(e=!1,a.prop("disabled",!0),o.html(""))});var i={relationships:{wife:"Wife",husband:"Husband",son:"Son",daughter:"Daughter",other:"Other"},agesBracket:{},loadMore:function(e){var a="";if(e)for(var t=1;t<=e;t++)a+='<div class="row">',a+='<div class="col-md-2">',a+='<div class="form-group">',a+="<label>Name</label>",a+='<input type="text" name="other_name'+t+'" class="form-control"/>',a+="</div>",a+="</div>",a+='<div class="col-md-2">',a+='<div class="form-group">',a+="<label>Relationship</label>",a+='<select name="other_relationship'+t+'" class="form-control"><option value="Wife">Wife</option> <option value="Husband">Husband</option> <option value="Son">Son</option><option value="Daughter">Daughter</option><option value="Other">Other</option> </select>',a+="</div>",a+="</div>",a+='<div class="col-md-2">',a+='<div class="form-group">',a+="<label>Age Bracket</label>",a+='<select name="other_bracket'+t+'" class="form-control"><option value="3-17">3-17</option><option value="18-21">18 - 21</option><option value="22-25">22 - 25</option><option value="26-30">26 - 30</option><option value="31-40">31 - 40</option><option value="41-50">41 - 50</option><option value="51-60">51 - 60</option><option value="61-69">61 - 69</option><option value="70 or over">70 or over</option></select>',a+="</div>",a+="</div>",a+='<div class="col-md-2">',a+='<div class="form-group">',a+="<label>Education</label>",a+='<select name="other_education'+t+'" class="form-control"><option value="Primary">Primary</option><option value="Secondary">Secondary</option><option value="College">College</option></select>',a+="</div>",a+="</div>",a+='<div class="col-md-2">',a+='<div class="form-group">',a+="<label>Band</label>",a+='<select name="other_band'+t+'" class="form-control"><option value="band1">Band 1</option><option value="band2">Band 2</option><option value="band3">Band 3</option><option value="band4">Band 4</option><option value="band5">Band 5</option><option value="band6">Band 6</option><option value="band7">Band 7</option></select>',a+="</div>",a+="</div>",a+='<div class="col-md-2">',a+='<div class="form-group">',a+="<label>Plan</label>",a+='<select name="other_class'+t+'" class="form-control"><option value="class1">Class I</option><option value = "class2">Class II </option></select>',a+="</div>",a+="</div>",a+="</div>",a+="<hr/>";o.html(a)}};a.change(function(){e&&i.loadMore(parseInt($(this).val()))})}},d={submitForm:function(){$.ajax({url:o.attr("action"),dataType:"json",method:"POST",data:o.serialize(),success:function(e){e.quote&&(i=e.quote,$("#quote_id").val(i)),d.preview()}})},createTab:function(){d.removeTabs(),$("#tab4").length||($("ul.nav li:last").after('<li><a href="#tab4" data-toggle="tab">Quotation</a></li>'),$("#tab3").after('<div class="tab-pane" id="tab4"><center>'+PRELOADER2+"</center></div>"),$("a[href=#tab4]").click())},removeTabs:function(){$('li:has(a[href="#tab4"])').remove(),$("#tab4").remove()},preview:function(){$.ajax({url:SITE_PATH+"/admin/myquote/view/"+i,method:"GET",beforeSend:function(){d.createTab()},success:function(e){var a=$("<div>"+e+"</div>");a.find("button").remove(),$("#tab4").html(a);var t=encodeURI("policies/createpolicy/"+i);$(document).find("#proceed_with_policy").attr("href",SITE_PATH+"/ajax/admin/quotes/internalacceptquote/"+i+"?return="+t)},error:function(e){$("#tab4").html("<p>Cannot generate quotation</p><pre>"+e+"</pre>")}})}},c={autoFill:function(e){$.each(e,function(e,a){var t=$("[name="+e+"]");t.is(":radio")?$("[name="+e+"][value="+a+"]").attr("checked","checked"):t.is(":checkbox")?$("[name="+e+"][value="+a+"]").prop("checked",!0):t.val(a)})}};e.click(function(){r.isFormValid()}),r.createTabs(),r.datePickers(),r.setUrl();try{c.autoFill(customer_data)}catch(e){}});