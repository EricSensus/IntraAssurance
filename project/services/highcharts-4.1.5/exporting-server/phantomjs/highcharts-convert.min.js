!function(){"use strict";var t,e,o,i,r={files:{JQUERY:"jquery.1.9.1.min.js",HIGHCHARTS:"highcharts.js",HIGHCHARTS_MORE:"highcharts-more.js",HIGHCHARTS_DATA:"data.js",HIGHCHARTS_DRILLDOWN:"drilldown.js",HIGHCHARTS_FUNNEL:"funnel.js",HIGHCHARTS_HEATMAP:"heatmap.js",HIGHCHARTS_3D:"highcharts-3d.js",HIGHCHARTS_NODATA:"no-data-to-display.js",HIGHCHARTS_SOLID_GAUGE:"solid-gauge.js",BROKEN_AXIS:"broken-axis.js"},TIMEOUT:5e3},n=!1,a=require("system"),s=require("fs"),c=!1;if(i=function(){var t,e,o=arguments,i=o.length;for(t=0;t<i;t+=1)if(void 0!==(e=o[t])&&null!==e&&"null"!==e&&"0"!=e)return e},t=function(){var t,e,o={};for(a.args.length<1&&(console.log("Commandline Usage: highcharts-convert.js -infile URL -outfile filename -scale 2.5 -width 300 -constr Chart -callback callback.js"),console.log(", or run PhantomJS as server: highcharts-convert.js -host 127.0.0.1 -port 1234")),t=0;t<a.args.length;t+=1)if("-"===a.args[t].charAt(0))if("infile"===(e=a.args[t].substr(1,t.length))||"callback"===e||"dataoptions"===e||"globaloptions"===e||"customcode"===e)try{o[e]=s.read(a.args[t+1]).replace(/^\s+/,"")}catch(e){console.log("Error: cannot find file, "+a.args[t+1]),phantom.exit()}else o[e]=a.args[t+1];return o},e=function(t,e){function o(){(y-=1)<1&&(T=!0)}function n(t){var e,i;for(y=t.length,e=0;e<t.length;e+=1)i=new Image,i.onload=i.onerror=o,i.src=t[e]}var a,l,h,d,p,g,u,m,f,w,v,b,H,y,C=require("webpage").create(),R={},T=!1;R.optionsParsed="Highcharts.options.parsed",R.callbackParsed="Highcharts.cb.parsed",window.optionsParsed=!1,window.callbackParsed=!1,C.onConsoleMessage=function(t){console.log(t),t===R.optionsParsed&&(window.optionsParsed=!0),t===R.callbackParsed&&(window.callbackParsed=!0)},C.onAlert=function(t){console.log(t)},a=function(e){var o,r,n=1,a=i(t.width,e.width);parseInt(a,10)==a&&(n=a/e.width),C.zoomFactor=t.scale&&void 0==t.width?n*t.scale:n,o=e.width*C.zoomFactor,r=e.height*C.zoomFactor,C.clipRect={top:0,left:0,width:o,height:r},"pdf"===m&&(o*=1.4,r*=1.4,C.viewportSize={width:o,height:r},C.paperSize={width:o+2,height:r+2})},b=function(t){c&&C.close(),e(t)},v=function(t){var e;a(t),"pdf"!==m&&void 0===u&&c?(e=C.renderBase64(m),b(e)):(void 0===u&&(u=r.tmpDir+"/chart."+m),C.render(u),b(u))},w=function(t){var o;t.imgUrls.length>0?n(t.imgUrls):T=!0;try{"svg"===m.toLowerCase()?(t=t.html.replace(/<svg /,'<svg xmlns:xlink="http://www.w3.org/1999/xlink" ').replace(/ href=/g," xlink:href=").replace(/<\/svg>.*?$/,"</svg>"),t='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'+t,void 0!==u?(o=s.open(u,"w"),o.write(t),o.close(),b(u)):b(t)):T?v(t):(H=window.setInterval(function(){T&&(clearTimeout(f),clearInterval(H),v(t))},50),f=window.setTimeout(function(){clearInterval(H),e("ERROR: While rendering, there's is a timeout reached")},r.TIMEOUT))}catch(t){console.log("ERROR: While rendering, "+t)}},l=function(t,e){var o,i,r,n,a,s,c,l;for(document.body.style.margin="0px",document.body.innerHTML=t,"jpeg"===e&&(document.body.style.backgroundColor="white"),i=document.querySelectorAll("*[stroke-opacity]"),o=0;o<i.length;o+=1)r=i[o],n=r.getAttribute("stroke-opacity"),r.removeAttribute("stroke-opacity"),r.setAttribute("opacity",n);for(a=document.getElementsByTagName("svg")[0],s=document.getElementsByTagName("image"),c=[],l=0;l<s.length;l+=1)c.push(s[l].href.baseVal);return{html:document.body.innerHTML,width:a.getAttribute("width"),height:a.getAttribute("height"),imgUrls:c}},h=function(t,e,o,i,r,n,a,s){function c(t,e){var o=$("<script>").attr("type","text/javascript");o.html("var "+t+" = "+e),document.getElementsByTagName("head")[0].appendChild(o[0]),void 0!==window[t]&&console.log("Highcharts."+t+".parsed")}function l(t,e,o){try{o.complete=t,Highcharts.data(o,e)}catch(e){t(void 0)}}var h,d,p,g,u,m,f,w,v;for("undefined"!==e&&c("options",e),"undefined"!==a&&c("cb",a),"undefined"!==o&&c("globalOptions",o),"undefined"!==i&&c("dataOptions",i),"undefined"!==r&&c("customCode",r),$(document.body).css("margin","0px"),"jpeg"===n&&$(document.body).css("backgroundColor","white"),h=$("<div>").appendTo(document.body),h.attr("id","container"),Highcharts.SVGRenderer.prototype.Element.prototype.animate=Highcharts.SVGRenderer.prototype.Element.prototype.attr,Highcharts.setOptions({plotOptions:{series:{animation:!1}}}),options.chart||(options.chart={}),options.chart.renderTo=h[0],options.chart.width=options.exporting&&options.exporting.sourceWidth||options.chart.width||600,options.chart.height=options.exporting&&options.exporting.sourceHeight||options.chart.height||400,globalOptions&&Highcharts.setOptions(globalOptions),dataOptions?l(function(e){options.series&&Highcharts.each(options.series,function(t,o){options.series[o]=Highcharts.merge(t,e.series[o])});var o=Highcharts.merge(e,options);customCode&&customCode(o),d=new Highcharts[t](o,cb)},options,dataOptions):d=new Highcharts[t](options,cb),p=document.querySelectorAll("*[stroke-opacity]"),g=0;g<p.length;g+=1)u=p[g],m=u.getAttribute("stroke-opacity"),u.removeAttribute("stroke-opacity"),u.setAttribute("opacity",m);for(w=document.getElementsByTagName("image"),v=[],f=0;f<w.length;f+=1)v.push(w[f].href.baseVal);return{html:$("div.highcharts-container")[0].innerHTML,width:d.chartWidth,height:d.chartHeight,imgUrls:v}},t.length<1?b("Error: Insufficient parameters"):(d=t.infile,u=t.outfile,m=void 0!==u?i(u.split(".").pop(),"png"):i(t.type,"png"),p=i(t.constr,"Chart"),g=t.callback,t.width,void 0!==d&&0!==d.length||b("Error: Insuficient or wrong parameters for rendering"),C.open("about:blank",function(e){var o,i,n=t.globaloptions,a=t.dataoptions,s="function customCode(options) {\n"+t.customcode+"}\n";if("<svg"===d.substring(0,4).toLowerCase()||"<?xml"===d.substring(0,5).toLowerCase()||"<!doctype"===d.substring(0,9).toLowerCase())o=C.evaluate(l,d,m),C.viewportSize={width:o.width,height:o.height},w(o);else{for(i in r.files)r.files.hasOwnProperty(i)&&C.injectJs(r.files[i]);o=C.evaluate(h,p,d,n,a,s,m,g,R),window.optionsParsed||b("ERROR: the options variable was not available or couldn't be parsed, does the infile contain an syntax error? Input used:"+d),void 0===g||window.callbackParsed||b("ERROR: the callback variable was not available, does the callback contain an syntax error? Callback used: "+g),w(o)}}))},n=function(t,o){require("webserver").create().listen(t+":"+o,function(t,o){var i,r,n=t.postRaw||t.post;try{i=JSON.parse(n),i.status?(o.statusCode=200,o.write("OK"),o.close()):e(i,function(t){o.statusCode=200,o.write(t),o.close()})}catch(t){r="Failed rendering: \n"+t,o.statusCode=500,o.setHeader("Content-Type","text/plain"),o.setHeader("Content-Length",r.length),o.write(r),o.close()}}),c=!0,console.log("OK, PhantomJS is ready.")},o=t(),void 0===o.tmpdir?r.tmpDir=s.workingDirectory+"/tmp":r.tmpDir=o.tmpdir,!s.exists(r.tmpDir))try{s.makeDirectory(r.tmpDir)}catch(t){console.log("ERROR: Cannot create temp directory for "+r.tmpDir)}void 0!==o.host&&void 0!==o.port?n(o.host,o.port):e(o,function(t){console.log(t),phantom.exit()})}();