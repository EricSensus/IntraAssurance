!function(t){function a(t){return t.find("> li > a:not(.disabled), > li > :not(ul) a:not(.disabled)").eq(0)}function e(t){return t.find("> li > a:not(.disabled), > li > :not(ul) a:not(.disabled)").eq(-1)}function s(t,e){var s=t.nextAll("li").find("> a:not(.disabled), > :not(ul) a:not(.disabled)").eq(0);return e||s.length?s:a(t.parent())}function i(a,s){var i=a.prevAll("li").find("> a:not(.disabled), > :not(ul) a:not(.disabled)").eq(/^1\.8\./.test(t.fn.jquery)?0:-1);return s||i.length?i:e(a.parent())}t.fn.focusSM=function(){return this.length&&this[0].focus&&this[0].focus(),this},t.extend(t.SmartMenus.Keyboard={},{docKeydown:function(d){var l=d.keyCode;if(/^(37|38|39|40)$/.test(l)){var c=t(this),u=c.data("smartmenus"),n=t(d.target);if(u&&n.is("a")&&u.handleItemEvents(n)){var o=n.closest("li"),m=o.parent(),v=m.dataSM("level");switch(c.hasClass("sm-rtl")&&(37==l?l=39:39==l&&(l=37)),l){case 37:if(u.isCollapsible())break;v>2||2==v&&c.hasClass("sm-vertical")?u.activatedItems[v-2].focusSM():c.hasClass("sm-vertical")||i((u.activatedItems[0]||n).closest("li")).focusSM();break;case 38:if(u.isCollapsible()){var r;v>1&&(r=a(m)).length&&n[0]==r[0]?u.activatedItems[v-2].focusSM():i(o).focusSM()}else 1==v&&!c.hasClass("sm-vertical")&&u.opts.bottomToTopSubMenus?(!u.activatedItems[0]&&n.dataSM("sub")&&(u.itemActivate(n),n.dataSM("sub").is(":visible")&&(u.focusActivated=!0)),u.activatedItems[0]&&u.activatedItems[0].dataSM("sub")&&u.activatedItems[0].dataSM("sub").is(":visible")&&!u.activatedItems[0].dataSM("sub").hasClass("mega-menu")&&e(u.activatedItems[0].dataSM("sub")).focusSM()):(v>1||c.hasClass("sm-vertical"))&&i(o).focusSM();break;case 39:if(u.isCollapsible())break;1==v&&c.hasClass("sm-vertical")?(!u.activatedItems[0]&&n.dataSM("sub")&&(u.itemActivate(n),n.dataSM("sub").is(":visible")&&(u.focusActivated=!0)),u.activatedItems[0]&&u.activatedItems[0].dataSM("sub")&&u.activatedItems[0].dataSM("sub").is(":visible")&&!u.activatedItems[0].dataSM("sub").hasClass("mega-menu")&&a(u.activatedItems[0].dataSM("sub")).focusSM()):1!=v&&(!u.activatedItems[v-1]||u.activatedItems[v-1].dataSM("sub")&&u.activatedItems[v-1].dataSM("sub").is(":visible")&&!u.activatedItems[v-1].dataSM("sub").hasClass("mega-menu"))||c.hasClass("sm-vertical")?u.activatedItems[v-1]&&u.activatedItems[v-1].dataSM("sub")&&u.activatedItems[v-1].dataSM("sub").is(":visible")&&!u.activatedItems[v-1].dataSM("sub").hasClass("mega-menu")&&a(u.activatedItems[v-1].dataSM("sub")).focusSM():s((u.activatedItems[0]||n).closest("li")).focusSM();break;case 40:if(u.isCollapsible()){var b,f;if(u.activatedItems[v-1]&&u.activatedItems[v-1].dataSM("sub")&&u.activatedItems[v-1].dataSM("sub").is(":visible")&&!u.activatedItems[v-1].dataSM("sub").hasClass("mega-menu")&&(b=a(u.activatedItems[v-1].dataSM("sub"))).length)b.focusSM();else if(v>1&&(f=e(m)).length&&n[0]==f[0]){for(var S=u.activatedItems[v-2].closest("li"),M=null;S.is("li")&&!(M=s(S,!0)).length;)S=S.parent().parent();M.length?M.focusSM():a(c).focusSM()}else s(o).focusSM()}else 1!=v||c.hasClass("sm-vertical")||u.opts.bottomToTopSubMenus?(v>1||c.hasClass("sm-vertical"))&&s(o).focusSM():(!u.activatedItems[0]&&n.dataSM("sub")&&(u.itemActivate(n),n.dataSM("sub").is(":visible")&&(u.focusActivated=!0)),u.activatedItems[0]&&u.activatedItems[0].dataSM("sub")&&u.activatedItems[0].dataSM("sub").is(":visible")&&!u.activatedItems[0].dataSM("sub").hasClass("mega-menu")&&a(u.activatedItems[0].dataSM("sub")).focusSM())}d.stopPropagation(),d.preventDefault()}}}}),t(document).delegate("ul.sm","keydown.smartmenus",t.SmartMenus.Keyboard.docKeydown),t.extend(t.SmartMenus.prototype,{keyboardSetHotkey:function(e,s){var i=this;t(document).bind("keydown.smartmenus"+this.rootId,function(d){if(e==d.keyCode){var l=!0;s&&("string"==typeof s&&(s=[s]),t.each(["ctrlKey","shiftKey","altKey","metaKey"],function(a,e){if(t.inArray(e,s)>=0&&!d[e]||t.inArray(e,s)<0&&d[e])return l=!1,!1})),l&&(a(i.$root).focusSM(),d.stopPropagation(),d.preventDefault())}})}})}(jQuery);